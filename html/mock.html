<!-- Auto generated by http://github.com/bcambel/pythonarticles at 2013-07-17 11:05:26.790836UTC-->
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Python Unit testing with Mock library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Python Unit testing with Mock library"/>
    <meta property="og:type" content="article"/>
    <meta property="og:url" content="http://pythonarticles.com/mock.html"/>
    <meta property="og:site_name" content="PythonArticles"/>
    <meta property="og:description" content="Mock library helps you to easily create mock objects and make assertions about how they have been used."/>
    <meta name="description" content="Mock library helps you to easily create mock objects and make assertions about how they have been used." />
    <meta name='keywords' content='python unit testing, python mock, python testing' />
    <link rel="alternate" type="application/rss+xml" title="PythonArticles RSS Feed" href="http://pythonarticles.com/rss.xml" />

    <link href="http://fonts.googleapis.com/css?family=Muli|Domine|Amaranth:400,700&subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <!--link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"-->
 	<link href="//netdna.bootstrapcdn.com/bootswatch/2.3.2/flatly/bootstrap.min.css" rel='stylesheet' >
   <link href="//netdna.bootstrapcdn.com/font-awesome/2.0/css/font-awesome.css" rel="stylesheet">
    <link href="/static/css/app.css?v=2" rel="stylesheet">
    <link href="/static/css/pysegments.css?v=2" rel="stylesheet">
</head>
<body>


<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="/">&nbsp;Python Articles&nbsp;</a>
            <ul class="nav">
                <li class=""><a href="/">Home</a></li>
                <li class="">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">Posts<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <li>
                            <a href="/decorators_part1.html">
                                decorators part1
                            </a>
                        </li>
                        
                        <li>
                            <a href="/decorators_part2.html">
                                decorators part2
                            </a>
                        </li>
                        
                        <li>
                            <a href="/generators.html">
                                generators
                            </a>
                        </li>
                        
                        <li>
                            <a href="/introduction_to_flask.html">
                                introduction to flask
                            </a>
                        </li>
                        
                        <li>
                            <a href="/itertools.html">
                                itertools
                            </a>
                        </li>
                        
                        <li>
                            <a href="/mock.html">
                                mock
                            </a>
                        </li>
                        
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li>
                    <a href='/rss.xml' ><i class='icon-rss'></i> &nbsp;RSS </a>
                </li>
            </ul>
        </div>
    </div>
</div>
    <div class="container main-content">
        
<article id="content_html" class="span10">
    <span class='pull-right article_date'>2013-07-17</span>

    <h1>Unit testing with Mock</h1>

<p><a href="http://www.voidspace.org.uk/python/mock/index.html">Mock</a> is a nice library designed to help you testing your code. It's extremenly flexible and
easy to start with.</p>

<div class='alert alert-info'>
pip install mock
</div>

<p>One of the biggest problem with the unit testing when you are using Django like framework, the unit testing includes database
stuff which really slows down your unit test's run time and also creates a lot of garbage, and a lot of useless code.
But you don't need to use django unittests to code unit tests in a Django project.</p>

<p><a href="http://www.voidspace.org.uk/python/mock/index.html">Mock</a> library helps you to achieve that.
I highly suggest you to also take a look at the <a href='https://factoryboy.readthedocs.org/en/latest/' target='_blank'><code>Factory_Boy</code> library</a></p>

<h2>How to return a value when a method is called ?</h2>

<p>The <code>return_value</code> attribute ( or keyword argument ) enabled to return a value when a method is called.</p>

<p>Example;</p>

<div class="syntax"><pre><code><span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="s">&#39;thing&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="p">(</span><span class="s">&#39;some&#39;</span><span class="p">,</span> <span class="s">&#39;thing&#39;</span><span class="p">,</span> <span class="s">&#39;else&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">assert_any_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="s">&#39;thing&#39;</span><span class="p">)</span>
</code></pre></div>

<h2>How to raise an exception when a method is called ?</h2>

<p>The <code>side_effect</code> attribute ( or keyword argument ) helps you to raise an exception when a method is called</p>

<p>For example ;</p>

<div class="syntax"><pre><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="ne">IndexError</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="o">...</span>
<span class="ne">IndexError</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">mock_calls</span>
<span class="p">[</span><span class="n">call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Bang!&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span><span class="p">(</span><span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">,</span> <span class="s">&#39;four&#39;</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="o">...</span>
<span class="ne">KeyError</span><span class="p">:</span> <span class="s">&#39;Bang!&#39;</span>
</code></pre></div>

<h2>How to check if a mocked method is called ? ( Expectation )</h2>

<p>If you expect a specific method is called with specific argument, use the <code>assert<em>called</em>with</code> method in your mock object</p>

<div class="syntax"><pre><code><span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&#39;wow&#39;</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">Mock</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;mock.method()&#39;</span> <span class="nb">id</span><span class="o">=</span><span class="s">&#39;...&#39;</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&#39;wow&#39;</span><span class="p">)</span>
</code></pre></div>

<p>If you expect a method whether called <strong>only one time</strong>, use the <code>assert<em>called</em>once_with</code> method in your mock object</p>

<div class="syntax"><pre><code><span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;baz&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;baz&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;baz&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;baz&#39;</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="o">...</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="n">Expected</span> <span class="n">to</span> <span class="n">be</span> <span class="n">called</span> <span class="n">once</span><span class="o">.</span> <span class="n">Called</span> <span class="mi">2</span> <span class="n">times</span><span class="o">.</span>
</code></pre></div>

<p>The above example calls the mock, and it does not fail at the first time, but after the second call, <code>AssertionError</code>
is raised.</p>

<p>assert<em>any</em>call</p>

<p>assert<em>has</em>calls</p>

<p>reset_mock</p>

<p>configure_mock</p>

<p>Set attributes on the mock through keyword arguments.</p>

<p>Attributes plus return values and side effects can be set on child mocks using standard dot notation and unpacking a dictionary in the method call:</p>

<div class="syntax"><pre><code><span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;method.return_value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;other.side_effect&#39;</span><span class="p">:</span> <span class="ne">KeyError</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">configure_mock</span><span class="p">(</span><span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mock</span><span class="o">.</span><span class="n">other</span><span class="p">()</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="o">...</span>
<span class="ne">KeyError</span>
</code></pre></div>

    <hr />
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="en" data-related="bahadircambel: Entreprenership 'n Programming " data-text='Python Unit testing with Mock library'>Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>
</article>


        <div id="disqus_thread"></div>
        <hr />

        <div class="footer">
            <i class="icon-github"></i>&nbsp;<a href="https://github.com/bcambel/pythonarticles">GitHub</a> /
            <i class="icon-twitter"></i>&nbsp;<a href="http://twitter.com/bahadircambel">Twitter</a> /
            <i class="icon-envelope-alt"></i>&nbsp;<a href="mailto:pyhackers@gmail.com">E-Mail</a>
        <br />
        &copy; Copyright 2013 pythonarticles.com. Made in Amsterdam with <span style='color:red'><i class='icon-heart'></i></span>&nbsp;by <a href='http://blog.bahadir.io'>Bahadir Cambel</a>
        </div>
    </div>


<script type="text/javascript">
    var disqus_shortname = 'pythonarticles';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.masonry.js"></script>

<script src="/static/js/app.js" type='text/javascript'></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42128994-3', 'pythonarticles.com');
  ga('send', 'pageview');

</script>
<script>
    (function(d, t) {
        var g = d.createElement(t),
                s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>
</body>
</html>